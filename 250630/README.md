# WiFi 室內定位系統改進方案250630

## 問題描述
當前的室內定位系統在建築物分類方面存在準確率不足的問題，有時會將使用者分類到錯誤的建築物中。

## 改進方案

本專案實現了一系列針對 WiFi 室內定位系統的改進方案，特別是提升建築物分類的準確率：

### 1. 資料品質改進

- **增強數據預處理**
  - 更穩健的數據標準化方法
  - 信號缺失值處理優化
  - 數據品質分析與報告

- **特徵工程**
  - 識別關鍵 AP 信號
  - 加入信號穩定性特徵
  - 移除低資訊量特徵

### 2. 模型架構改進

- **注意力機制**
  - 實現 AP 信號的注意力權重計算
  - 自動識別建築物分類的關鍵 AP

- **階層式深度學習架構**
  - 加強建築物分類分支
  - 使用較深層網路提取複雜特徵
  - 添加正則化防止過擬合
  - 優化不同任務間的特徵共享

### 3. 訓練策略改進

- **加權損失函數**
  - 加大建築物分類的權重
  - 實現動態權重調整

- **學習率排程**
  - 實現 ReduceLROnPlateau 策略
  - 根據建築物分類性能動態調整學習率

- **早停策略**
  - 以建築物分類準確率為監控指標
  - 保存最佳模型權重

## 使用方法

### 1. 數據預處理
```bash
cd preprocess
python run_preprocessing.py
```

預處理後會輸出:
- 數據質量分析報告
- 關鍵 AP 識別結果
- 建築物及樓層分布統計

### 2. 訓練改進模型
```bash
python model_improvements.py
```

訓練過程將:
- 實現注意力機制和增強的深度學習架構
- 針對建築物分類問題進行優化
- 自動調整學習率和早停機制

### 3. 模型評估
```bash
python evaluate_model.py
```

評估將生成:
- 建築物和樓層分類混淆矩陣
- 位置預測誤差分析
- 誤分類樣本詳細分析
- 視覺化結果報告

## 檔案說明

- **preprocess/**: 資料預處理相關模組
  - **run_preprocessing.py**: 主要預處理流程，包括增強的資料品質分析
  - **extract_and_filter.py**: WiFi 資料提取和過濾
  - **create_vector_format.py**: 向量化資料處理
  - **hadnn_adapter.py**: 準備 HADNN 格式資料

- **model_improvements.py**: 改進的模型架構和訓練方法
  - 實現注意力機制
  - 優化的深度學習架構
  - 加強的訓練策略

- **evaluate_model.py**: 全面的模型評估工具
  - 多指標評估
  - 混淆矩陣生成
  - 錯誤分析
  - 視覺化報告

## 預期改進效果

- **建築物分類準確率**: 預期從當前水平提升至 95% 以上
- **樓層分類準確率**: 維持在 90% 以上
- **位置預測準確度**: MSE 控制在 10.0 以下

## 後續優化方向

- **集成學習方法**: 結合多個模型的預測結果
- **自適應特徵選擇**: 動態選擇對特定建築物分類最有效的特徵
- **遲早融合實驗**: 比較不同層級特徵融合的效果
- **時序資訊整合**: 利用連續位置資訊提高準確率
